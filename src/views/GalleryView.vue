<template>
  <div class="min-h-screen py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- È°∂ÈÉ®ÊéßÂà∂Ê†è -->
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">Â™í‰ΩìÂ∫ì</h2>
        <div class="flex gap-3">
          <!-- Êñá‰ª∂Á±ªÂûãÁ≠õÈÄâ -->
          <select v-model="filter" 
                  class="px-3 py-1.5 text-sm rounded-lg border border-gray-200 
                         bg-white dark:bg-gray-800 dark:border-gray-700
                         focus:ring-1 focus:ring-primary-500 focus:border-primary-500
                         outline-none transition-all duration-200">
            <option value="all">ÂÖ®ÈÉ®Êñá‰ª∂</option>
            <option value="image">ÂõæÁâá</option>
            <option value="video">ËßÜÈ¢ë</option>
            <option value="audio">Èü≥È¢ë</option>
          </select>

          <!-- ÊéíÂ∫èÊåâÈíÆÂíå‰∏ãÊãâËèúÂçï -->
          <div class="relative">
            <button 
              @click.stop="showSortMenu = !showSortMenu"
              class="sort-button px-3 py-1.5 text-sm rounded-lg border border-gray-200 
                     bg-white dark:bg-gray-800 dark:border-gray-700
                     hover:bg-gray-50 dark:hover:bg-gray-700
                     transition-all duration-200
                     flex items-center gap-1.5"
            >
              <span>{{ sortOptions[currentSort] }}</span>
              <svg class="w-3.5 h-3.5 transition-transform duration-200"
                   :class="{ 'rotate-180': showSortMenu }"
                   viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- ÊéíÂ∫è‰∏ãÊãâËèúÂçï -->
            <div v-show="showSortMenu"
                 class="sort-menu absolute right-0 mt-1 w-40 
                        bg-white dark:bg-gray-800 
                        rounded-lg shadow-lg ring-1 ring-black/5 dark:ring-white/5
                        overflow-hidden"
                 :style="{ zIndex: 20 }">
              <div class="py-1">
                <button v-for="(label, value) in sortOptions" 
                        :key="value"
                        @click="handleSort(value)"
                        class="w-full px-4 py-1.5 text-sm text-left
                               hover:bg-gray-50 dark:hover:bg-gray-700
                               transition-colors duration-200
                               flex items-center justify-between"
                        :class="{ 
                          'text-primary-500 bg-primary-50/50 dark:bg-primary-900/10': currentSort === value,
                          'text-gray-700 dark:text-gray-200': currentSort !== value
                        }"
                >
                  <span>{{ label }}</span>
                  <svg v-if="currentSort === value" 
                       class="w-4 h-4 text-primary-500" 
                       viewBox="0 0 20 20" 
                       fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
      <div v-if="loading && !mediaItems.length" 
           class="min-h-[400px] flex items-center justify-center">
        <ScrollLoader text="Ê≠£Âú®Âä†ËΩΩÂ™í‰ΩìÂ∫ì" />
      </div>

      <!-- Â™í‰ΩìÁΩëÊ†º -->
      <div v-if="groupedMediaItems.length" class="space-y-8">
        <div v-for="group in groupedMediaItems" 
             :key="group.date" 
             class="space-y-4">
          <!-- Êó•ÊúüÊ†áÈ¢ò -->
          <h3 class="text-lg font-medium py-2 mb-2 border-b border-gray-100 dark:border-gray-800">
            {{ formatGroupDate(group.date) }}
          </h3>

          <!-- ÂàÜÁªÑÁΩëÊ†º -->
          <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            <TransitionGroup 
              name="media-grid"
              appear
              tag="div"
              class="contents"
            >
              <div v-for="item in group.items" 
                   :key="item.id" 
                   class="group relative aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800">
                <!-- È¢ÑËßàÂõæ -->
                <template v-if="item.type.startsWith('image')">
                  <div v-if="!item.loaded" 
                       class="w-full h-full animate-pulse bg-gray-200 dark:bg-gray-700">
                    <!-- È™®Êû∂Â±èÂä®Áîª -->
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skeleton-shine"></div>
                  </div>
                  <img :src="item.thumbnailUrl ? `${API_BASE_URL}${item.thumbnailUrl}` : item.url"
                       :alt="item.name"
                       class="w-full h-full object-cover"
                       :class="{
                         'opacity-0': !item.loaded,
                         'opacity-100': item.loaded
                       }"
                       @load="handleImageLoad(item)"
                       @error="handleImageError(item)">
                </template>
                <div v-else class="w-full h-full flex items-center justify-center text-4xl">
                  {{ getFileIcon(item.type) }}
                </div>
                
                <!-- ÊÇ¨ÊµÆÊìç‰ΩúÊ†è -->
                <div class="media-overlay">
                  <!-- Ê∏êÂèòËÉåÊôØ -->
                  <div class="absolute inset-0 bg-gradient-to-b from-transparent via-black/20 to-black/60"></div>
                  
                  <!-- Êñá‰ª∂‰ø°ÊÅØÂíåÊìç‰ΩúÊåâÈíÆ -->
                  <div class="relative p-4 text-white">
                    <p class="text-sm font-medium mb-3 truncate">{{ item.name }}</p>
                    <div class="flex items-center justify-center gap-3">
                      <button @click.stop="openPreview(item)" 
                              class="action-btn">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        <span class="text-xs">Êü•Áúã</span>
                      </button>

                      <button @click.stop="copyLink(item)" 
                              class="action-btn">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
                        </svg>
                        <span class="text-xs">Â§çÂà∂ÈìæÊé•</span>
                      </button>

                      <button @click.stop="handleDelete(item)" 
                              class="action-btn text-red-400 hover:text-red-300">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                        <span class="text-xs">Âà†Èô§</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </TransitionGroup>
          </div>
        </div>
      </div>

      <!-- Á©∫Áä∂ÊÄÅ -->
      <div v-else class="min-h-[400px] flex flex-col items-center justify-center text-gray-500 dark:text-gray-400">
        <div class="text-6xl mb-4">üìÅ</div>
        <p class="text-lg">ÊöÇÊó†Â™í‰ΩìÊñá‰ª∂</p>
      </div>

      <!-- Âä†ËΩΩÊõ¥Â§öËß¶ÂèëÂô® - ÁßªÂà∞ÁΩëÊ†ºÂ§ñÈÉ® -->
      <div v-if="hasMore && !initialLoading" 
           ref="loadMoreTrigger"
           class="scroll-trigger">
        <ScrollLoader v-if="loading" small />
        <!-- Ê∑ªÂä†‰∏Ä‰∏™Âç†‰ΩçÂÖÉÁ¥†Á°Æ‰øùËß¶ÂèëÂô®ÂßãÁªàÂèØËßÅ -->
        <div v-else class="h-4"></div>
      </div>
    </div>

    <!-- Â™í‰ΩìÈ¢ÑËßàÊ®°ÊÄÅÊ°Ü -->
    <MediaPreview
      v-if="selectedItem"
      :is-open="isPreviewOpen"
      :item="selectedItem"
      @close="closePreview"
    />
  </div>
</template>

<script setup>
import { ref, computed, onMounted, watch, onUnmounted, nextTick, onUpdated } from 'vue'
import MediaPreview from '../components/MediaPreview.vue'
import ScrollLoader from '../components/ScrollLoader.vue'
import { getMediaList, deleteFile } from '../api/upload'
import { ElMessage, ElMessageBox } from 'element-plus'
import { API_BASE_URL } from '../api/config'

const filter = ref('all')
const isPreviewOpen = ref(false)
const selectedItem = ref(null)
const loading = ref(false)
const showSortMenu = ref(false)
const currentSort = ref('uploadedAt')
const page = ref(1)
const hasMore = ref(true)
const mediaItems = ref([])
const initialLoading = ref(true)
const ITEMS_PER_PAGE = 20

// ÊéíÂ∫èÈÄâÈ°π
const sortOptions = {
  uploadedAt: 'ÊúÄËøë‰∏ä‰º†',
  name: 'Êñá‰ª∂Âêç',
  size: 'Êñá‰ª∂Â§ßÂ∞è'
}

// Âä†ËΩΩÂ™í‰ΩìÂàóË°®
const loadMediaList = async (isLoadMore = false) => {
  if (loading.value) return
  
  loading.value = true
  try {
    const result = await getMediaList({
      page: isLoadMore ? page.value : 1,
      limit: ITEMS_PER_PAGE,
      type: filter.value,
      sortBy: currentSort.value,
      order: 'desc'
    })
    
    if (result.success) {
      const processedItems = result.data.items.map(item => ({
        ...item,
        url: item.url.startsWith('http') ? item.url : `${API_BASE_URL}${item.url}`,
        thumbnailUrl: item.thumbnailUrl,
        loaded: false, // ÂàùÂßãÂåñÂä†ËΩΩÁä∂ÊÄÅ
        error: false
      }))

      if (isLoadMore) {
        mediaItems.value = [...mediaItems.value, ...processedItems]
      } else {
        mediaItems.value = processedItems
      }
      
      hasMore.value = processedItems.length === ITEMS_PER_PAGE
      page.value = isLoadMore ? page.value : 1

      // È¢ÑÂä†ËΩΩÂõæÁâá
      processedItems.forEach(item => {
        if (item.type.startsWith('image')) {
          const img = new Image()
          img.src = item.thumbnailUrl ? `${API_BASE_URL}${item.thumbnailUrl}` : item.url
          img.onload = () => handleImageLoad(item)
          img.onerror = () => handleImageError(item)
        }
      })
    } else {
      throw new Error(result.error)
    }
  } catch (error) {
    console.error('Âä†ËΩΩÂ§±Ë¥•:', error)
    ElMessage.error({
      message: `Âä†ËΩΩÂ§±Ë¥•: ${error.message || 'Êú™Áü•ÈîôËØØ'}`,
      type: 'error',
      duration: 5000
    })
  } finally {
    loading.value = false
    if (!isLoadMore) {
      initialLoading.value = false
    }
  }
}

// Âä†ËΩΩÊõ¥Â§öËß¶ÂèëÂô®
const loadMoreTrigger = ref(null)
let observer = null

// ËÆæÁΩÆ Intersection Observer
const setupIntersectionObserver = () => {
  if (observer) {
    observer.disconnect()
  }

  observer = new IntersectionObserver(async (entries) => {
    const trigger = entries[0]
    if (trigger.isIntersecting && hasMore.value && !loading.value) {
      console.log('Ëß¶ÂèëÂä†ËΩΩÊõ¥Â§ö')
      try {
        page.value++
        await loadMediaList(true)
      } catch (error) {
        console.error('Âä†ËΩΩÊõ¥Â§öÂ§±Ë¥•:', error)
      }
    }
  }, {
    rootMargin: '100px',
    threshold: 0.1
  })

  // Á°Æ‰øùÂú®‰∏ã‰∏Ä‰∏™‰∫ã‰ª∂Âæ™ÁéØ‰∏≠ËÆæÁΩÆËßÇÂØüËÄÖ
  nextTick(() => {
    if (loadMoreTrigger.value) {
      observer.observe(loadMoreTrigger.value)
      console.log('ËÆæÁΩÆËßÇÂØüËÄÖÊàêÂäü')
    }
  })
}

// ÁõëÂê¨ hasMore Âíå loading Áä∂ÊÄÅÂèòÂåñ
watch([hasMore, loading], ([newHasMore, newLoading]) => {
  if (newHasMore && !newLoading) {
    setupIntersectionObserver()
  }
})

// ÁªÑ‰ª∂ÊåÇËΩΩÊó∂ÂàùÂßãÂåñ
onMounted(async () => {
  await loadMediaList()
  setupIntersectionObserver()
  document.addEventListener('click', handleClickOutside)
})

// ÁªÑ‰ª∂Êõ¥Êñ∞Êó∂ÈáçÊñ∞ËÆæÁΩÆËßÇÂØüËÄÖ
onUpdated(() => {
  if (hasMore.value && !loading.value && loadMoreTrigger.value) {
    setupIntersectionObserver()
  }
})

// ÁªÑ‰ª∂Âç∏ËΩΩÊó∂Ê∏ÖÁêÜ
onUnmounted(() => {
  if (observer) {
    observer.disconnect()
    observer = null
  }
  document.removeEventListener('click', handleClickOutside)
})

// È¢ÑËßàÊéßÂà∂
const openPreview = (item) => {
  selectedItem.value = item
  isPreviewOpen.value = true
}

const closePreview = () => {
  isPreviewOpen.value = false
  selectedItem.value = null
}

// Â§çÂà∂ÈìæÊé•
const copyLink = async (item) => {
  try {
    if (item.url) {
      await navigator.clipboard.writeText(item.url)
      ElMessage.success({
        message: 'ÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø',
        type: 'success',
        duration: 2000
      })
    } else {
      throw new Error('Êñá‰ª∂ÈìæÊé•‰∏çÂèØÁî®')
    }
  } catch (error) {
    ElMessage.error({
      message: `Â§çÂà∂Â§±Ë¥•: ${error.message}`,
      type: 'error',
      duration: 2000
    })
  }
}

// Âà†Èô§Êñá‰ª∂
const handleDelete = async (item) => {
  try {
    await ElMessageBox.confirm(
      'Âà†Èô§ÂêéÂ∞ÜÊó†Ê≥ïÊÅ¢Â§çÊ≠§Êñá‰ª∂ÔºåÊòØÂê¶ÁªßÁª≠Ôºü',
      'Á°ÆËÆ§Âà†Èô§',
      {
        confirmButtonText: 'Âà†Èô§',
        cancelButtonText: 'ÂèñÊ∂à',
        type: 'warning',
        customClass: 'custom-message-box',
        confirmButtonClass: 'custom-confirm-button',
        cancelButtonClass: 'custom-cancel-button',
        center: true,
        icon: 'Warning'
      }
    )
    
    // ÂéüÊúâÁöÑÂà†Èô§ÈÄªËæë
    await deleteFile(item.id)
    mediaItems.value = mediaItems.value.filter(i => i.id !== item.id)
    ElMessage.success({
      message: 'Êñá‰ª∂Âà†Èô§ÊàêÂäü',
      type: 'success',
      duration: 2000
    })
  } catch (error) {
    if (error !== 'cancel') {
      console.error('Âà†Èô§Â§±Ë¥•:', error)
      ElMessage.error({
        message: `Âà†Èô§Â§±Ë¥•: ${error.message || 'Êú™Áü•ÈîôËØØ'}`,
        type: 'error',
        duration: 5000
      })
    }
  }
}

// Â§ÑÁêÜÊéíÂ∫è
const handleSort = (value) => {
  currentSort.value = value
  showSortMenu.value = false
  page.value = 1
  initialLoading.value = true
  loadMediaList()
}

// ÁõëÂê¨Á≠õÈÄâÂèòÂåñ
watch(filter, () => {
  page.value = 1
  initialLoading.value = true
  loadMediaList()
})

// ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠ÊéíÂ∫èËèúÂçï
const handleClickOutside = (event) => {
  // Ê£ÄÊü•ÁÇπÂáªÊòØÂê¶Âú®ÊéíÂ∫èÊåâÈíÆÊàñËèúÂçï‰πãÂ§ñ
  const sortButton = event.target.closest('.sort-button')
  const sortMenu = event.target.closest('.sort-menu')
  
  if (!sortButton && !sortMenu) {
    showSortMenu.value = false
  }
}

// Â§ÑÁêÜÂõæÁâáÂä†ËΩΩÂÆåÊàê
const handleImageLoad = (item) => {
  console.log('ÂõæÁâáÂä†ËΩΩÂÆåÊàê:', item.name) // Ê∑ªÂä†Ë∞ÉËØïÊó•Âøó
  const index = mediaItems.value.findIndex(i => i.id === item.id)
  if (index !== -1) {
    // ‰ΩøÁî® nextTick Á°Æ‰øùÁä∂ÊÄÅÊõ¥Êñ∞Âíå DOM Ê∏≤ÊüìÂêåÊ≠•
    nextTick(() => {
      mediaItems.value[index] = {
        ...mediaItems.value[index],
        loaded: true
      }
    })
  }
}

// Â§ÑÁêÜÂõæÁâáÂä†ËΩΩÂ§±Ë¥•
const handleImageError = (item) => {
  console.error('ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•:', item.name) // Ê∑ªÂä†Ë∞ÉËØïÊó•Âøó
  const index = mediaItems.value.findIndex(i => i.id === item.id)
  if (index !== -1) {
    nextTick(() => {
      mediaItems.value[index] = {
        ...mediaItems.value[index],
        error: true,
        loaded: true
      }
    })
  }
}

// Ëé∑ÂèñÊñá‰ª∂Á±ªÂûãÂõæÊ†á
const getFileIcon = (type) => {
  if (!type) return 'üìÑ' // ÈªòËÆ§Êñá‰ª∂ÂõæÊ†á
  
  // Ê†πÊçÆMIMEÁ±ªÂûãËøîÂõûÂØπÂ∫îÂõæÊ†á
  const iconMap = {
    'image/': 'üñºÔ∏è',
    'video/': 'üé•',
    'audio/': 'üéµ',
    'text/': 'üìù',
    'application/pdf': 'üìë',
    'application/msword': 'üìÑ',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'üìÑ', // .docx
    'application/vnd.ms-excel': 'üìä',
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'üìä', // .xlsx
    'application/vnd.ms-powerpoint': 'üìΩÔ∏è',
    'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'üìΩÔ∏è', // .pptx
    'application/zip': 'üì¶',
    'application/x-rar-compressed': 'üì¶',
    'application/x-7z-compressed': 'üì¶',
  }

  // ÈÅçÂéÜÂõæÊ†áÊò†Â∞ÑË°®ÔºåÊü•ÊâæÂåπÈÖçÁöÑÁ±ªÂûã
  for (const [mimeType, icon] of Object.entries(iconMap)) {
    if (type.startsWith(mimeType)) {
      return icon
    }
  }

  // Â¶ÇÊûúÊ≤°ÊúâÂåπÈÖçÁöÑÁ±ªÂûãÔºåËøîÂõûÈªòËÆ§Êñá‰ª∂ÂõæÊ†á
  return 'üìÑ'
}

// ÊåâÊó•ÊúüÂàÜÁªÑÁöÑÂ™í‰ΩìÈ°π
const groupedMediaItems = computed(() => {
  const groups = mediaItems.value.reduce((acc, item) => {
    // Ëé∑ÂèñÊó•ÊúüÔºà‰∏çÂåÖÂê´Êó∂Èó¥Ôºâ
    const date = item.uploadedAt.split('T')[0]
    
    // Êü•ÊâæÊàñÂàõÂª∫ÂàÜÁªÑ
    let group = acc.find(g => g.date === date)
    if (!group) {
      group = {
        date,
        items: []
      }
      acc.push(group)
    }
    
    group.items.push(item)
    return acc
  }, [])

  // ÊåâÊó•ÊúüÈôçÂ∫èÊéíÂ∫è
  return groups.sort((a, b) => b.date.localeCompare(a.date))
})

// Ê†ºÂºèÂåñÂàÜÁªÑÊó•Êúü
const formatGroupDate = (dateString) => {
  // ÂàõÂª∫Êó•ÊúüÂØπË±°Âπ∂ÁßªÈô§Êó∂Èó¥ÈÉ®ÂàÜ
  const date = new Date(dateString)
  date.setHours(0, 0, 0, 0)
  
  const today = new Date()
  today.setHours(0, 0, 0, 0)
  
  const yesterday = new Date(today)
  yesterday.setDate(today.getDate() - 1)

  // ËΩ¨Êç¢‰∏∫Êó∂Èó¥Êà≥ËøõË°åÊØîËæÉ
  const dateTimestamp = date.getTime()
  const todayTimestamp = today.getTime()
  const yesterdayTimestamp = yesterday.getTime()

  // Âà§Êñ≠ÊòØÂê¶ÊòØ‰ªäÂ§©ÊàñÊò®Â§©
  if (dateTimestamp === todayTimestamp) {
    return '‰ªäÂ§©'
  } else if (dateTimestamp === yesterdayTimestamp) {
    return 'Êò®Â§©'
  }

  // Âà§Êñ≠ÊòØÂê¶ÊòØ‰ªäÂπ¥
  const isThisYear = date.getFullYear() === today.getFullYear()
  
  // Ê†πÊçÆÊòØÂê¶ÊòØ‰ªäÂπ¥ËøîÂõû‰∏çÂêåÁöÑÊ†ºÂºè
  return date.toLocaleDateString('zh-CN', {
    year: isThisYear ? undefined : 'numeric',
    month: 'long',
    day: 'numeric'
  })
}
</script>

<style scoped>
/* ÁΩëÊ†ºÂä®Áîª */
.media-grid-move,
.media-grid-enter-active,
.media-grid-leave-active {
  transition: all 0.5s ease;
}

.media-grid-enter-from {
  opacity: 0;
  transform: scale(0.9) translateY(30px);
}

.media-grid-leave-to {
  opacity: 0;
  transform: scale(0.9);
}

.media-grid-leave-active {
  position: absolute;
}

.loading {
  @apply inline-block w-4 h-4 border-2 border-white rounded-full border-t-transparent animate-spin;
}

.btn-danger {
  @apply bg-red-500 text-white hover:bg-red-600 active:bg-red-700;
}

/* Êõ¥Êñ∞Âä†ËΩΩËß¶ÂèëÂô®Ê†∑Âºè */
.scroll-trigger {
  @apply py-8 flex items-center justify-center;
  min-height: 100px;
  margin-top: 1rem;
  /* Á°Æ‰øùËß¶ÂèëÂô®ÂèØËßÅ */
  opacity: 1;
  pointer-events: none;
}

/* Ê∑ªÂä†Ê∑°ÂÖ•Ê∑°Âá∫ÊïàÊûú */
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}

/* È™®Êû∂Â±èÂä®Áîª */
@keyframes skeleton-shine {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.skeleton-shine {
  animation: skeleton-shine 1.5s infinite;
}

/* ÂõæÁâáÊ∑°ÂÖ•ÊïàÊûú */
img {
  opacity: 1;
  transition: opacity 0.3s ease-in-out;
}

img.opacity-0 {
  opacity: 0;
}

/* ÂõæÁâáÂÆπÂô®Âü∫Á°ÄÊ†∑Âºè */
.group {
  @apply relative transition-all duration-300;
}

/* ÊÇ¨ÊµÆÊïàÊûú */
.group:hover {
  @apply scale-[1.02] shadow-lg;
}

.group:hover img {
  @apply brightness-75;
}

/* ÊÇ¨ÊµÆÊìç‰ΩúÂå∫Ê†∑Âºè */
.media-overlay {
  @apply absolute inset-0 flex flex-col justify-end opacity-0 transition-all duration-300;
  pointer-events: none;
}

.group:hover .media-overlay {
  @apply opacity-100;
  pointer-events: auto;
}

/* Êìç‰ΩúÊåâÈíÆÊ†∑Âºè */
.action-btn {
  @apply flex flex-col items-center gap-1 px-3 py-2 rounded-lg
         backdrop-blur-sm bg-white/10
         transition-all duration-300
         hover:bg-white/20 active:bg-white/30
         hover:scale-105 active:scale-95
         text-white;
  pointer-events: auto;
}

/* ÁßªÈô§ÂÖ∂‰ªñÂÜ≤Á™ÅÁöÑÊ†∑Âºè */
.hover-controls,
.hover-action-btn {
  display: none;
}

/* Êó•ÊúüÊ†áÈ¢òÊ†∑Âºè */
h3 {
  @apply transition-colors duration-300;
  letter-spacing: -0.01em;
}

/* ÂàÜÁªÑÂÆπÂô®Ê†∑Âºè */
.space-y-8 > div {
  @apply transition-all duration-500;
}

/* ‰ºòÂåñÁΩëÊ†ºÂä®Áîª */
.media-grid-move {
  transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

.media-grid-enter-active {
  transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

.media-grid-leave-active {
  transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  position: absolute;
}

.media-grid-enter-from {
  opacity: 0;
  transform: scale(0.95) translateY(10px);
}

.media-grid-leave-to {
  opacity: 0;
  transform: scale(0.95);
}

/* Á°Æ‰øù‰∏ãÊãâËèúÂçïÂú®ÊúÄ‰∏äÂ±Ç */
.sort-menu {
  z-index: 50;
}

/* Ëá™ÂÆö‰πâÁ°ÆËÆ§ÂØπËØùÊ°ÜÊ†∑Âºè */
.custom-message-box {
  border-radius: 12px !important;
  padding: 24px !important;
  background: rgba(255, 255, 255, 0.9) !important;
  backdrop-filter: blur(10px) !important;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12) !important;
}

.dark .custom-message-box {
  background: rgba(30, 30, 30, 0.9) !important;
}

.custom-message-box .el-message-box__header {
  padding: 0 !important;
  margin-bottom: 16px !important;
}

.custom-message-box .el-message-box__title {
  font-size: 18px !important;
  font-weight: 600 !important;
}

.custom-message-box .el-message-box__content {
  padding: 0 !important;
  margin-bottom: 24px !important;
  color: #666 !important;
}

.dark .custom-message-box .el-message-box__content {
  color: #aaa !important;
}

.custom-message-box .el-message-box__btns {
  padding: 0 !important;
  gap: 12px !important;
}

.custom-confirm-button {
  background: #ff3b30 !important;
  border-color: #ff3b30 !important;
  border-radius: 8px !important;
  padding: 10px 20px !important;
  font-weight: 500 !important;
  transition: all 0.2s ease !important;
}

.custom-confirm-button:hover {
  background: #ff1f1f !important;
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3) !important;
}

.custom-cancel-button {
  background: transparent !important;
  border: none !important;
  border-radius: 8px !important;
  padding: 10px 20px !important;
  color: #666 !important;
  font-weight: 500 !important;
  transition: all 0.2s ease !important;
}

.dark .custom-cancel-button {
  color: #aaa !important;
}

.custom-cancel-button:hover {
  background: rgba(0, 0, 0, 0.05) !important;
}

.dark .custom-cancel-button:hover {
  background: rgba(255, 255, 255, 0.1) !important;
}

/* Ê∑ªÂä†Âä®ÁîªÊïàÊûú */
.el-message-box {
  animation: messageBoxIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes messageBoxIn {
  0% {
    opacity: 0;
    transform: scale(0.95) translateY(10px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}
</style> 